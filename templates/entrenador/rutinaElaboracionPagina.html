<!doctype html>
<html layout:decorate="~{plantillaEntrenador}" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
  <head>
    <title>Elaborador rutinas</title>
    <meta charset="utf-8">
  </head>
  <body>
    <div layout:fragment="submenu-titulo">
		<span>Rutina</span>
    </div>
  	<div layout:fragment="content" style="height: 100vh">

		
  		<div class="row" style="height: 100%;">
  	
			<!-- Editor de datos generales -->
			<div id="accordion" class="col-2" style="height: calc(100% - 80px); position: fixed; left: 0px; top: 80px; bottom: 0px; z-index: 1035">

				<!-- Datos rutina -->
				<div class="row"  style="margin: 0;">
				
					<div class="col-12 pt-2 pb-2 mb-1 cursor-pointer shadow-sm" style="background:#0F4C81; color: #fff;" data-toggle="collapse" data-target="#rutinaDatosGeneralesFragment" aria-expanded="true" aria-controls="rutinaDatosGeneralesFragment">
						Rutina
					</div>
					
					<div class="text-right" style="width: 100%">
						<a href="#" onClick="comenzarCargarPlantillaAccion(this)" th:data-accion="@{/comenzarCargarPlantillaAccion}" th:data-rutina-id="${rutina.id}">
							<i class="fas fa-file-download mr-2"></i>
						</a>
						<a href="#" onClick="comenzarCrearPlantillaDesdeRutinaAccion(this)" th:data-accion="@{/comenzarCrearPlantillaDesdeRutinaAccion}" th:data-rutina-id="${rutina.id}">
							<i class="fas fa-file-upload"></i>
						</a>
						
						<div sec:authorize="hasAuthority('ROLE_SUPERUSUARIO')">
							<a class="btn btn-primary" onClick="analizarCorreccionesRutinas(this)" th:data-accion="@{/analizarCorreccionesRutinas}" th:data-rutina-id="${rutina.id}">Analizar</a>
						</div>
						
					</div>
					
					<div th:fragment="rutinaDatosGeneralesFragment" id="rutinaDatosGeneralesFragment" class="col-12 pl-0 pr-0 collapse show" aria-labelledby="headingOne" data-parent="#accordion">

							<form id="actualizarRutinaDatosGeneralesFormulario" th:action="@{/actualizarRutinaDatosGeneralesFormulario}" onsubmit="actualizarRutinaDatosGenerales(this, event)" th:object="${rutina}" method="post" novalidate>
								<input type="hidden" th:field="*{id}" />
								<div class="form-row">
									
				 					<div class="form-group col-12">
						            	<label th:for="${#ids.next('nombre')}"> Nombre de la rutina </label>
						            	<input type="text" class="form-control form-control-sm" th:field="*{nombre}" placeholder="Nombre de la rutina" maxlength="30"/> 
						            </div>
						            <div class="form-group col-12">
										<label th:for="${#ids.next('estadoCodigo')}"> Estado</label>
										<select class="form-control form-control-sm selectpicker" th:field="*{estado}" data-style="btn-select" title="Estado" required>
											<option th:each="estado : ${estadoSeleccionLista}" th:value="${estado.codigo}" th:text="${estado.nombre}"></option>
										</select>
									</div>
									<div class="form-group col-12">
						            	<label th:for="${#ids.next('entrenadorTiempoDescansoEntreEjercicios')}"> Descanso entre ejercicios (s)</label>
						            	<input type="text" class="form-control form-control-sm" th:field="*{entrenadorTiempoDescansoEntreEjercicios}" placeholder="Descanso en segundos" maxlength="30"/> 
						            </div>
						            <div class="form-group col-12">
									    <label th:for="${#ids.next('comentariosEntrenador')}">Comentarios entrenador</label>
									    <textarea class="form-control form-control-sm" th:field="*{comentariosEntrenador}" placeholder="Comentarios para el cliente" rows="3" required></textarea>
									</div>
									
									<div class="form-group col-12">
									    <label th:for="${#ids.next('comentariosCliente')}">Comentarios cliente</label>
									    <textarea class="form-control form-control-sm" readonly th:field="*{comentariosCliente}" placeholder="Comentarios del cliente" rows="3" required></textarea>
									</div>
									
									<div class="form-group col-12">
					  					<label for="fechaEntrenamientoSeleccionadaLista">Fechas entrenamiento</label>
										<select id="fechaEntrenamientoSeleccionadaLista" class="form-control form-control-sm selectpicker" th:field="*{rutinaFechaLista}" data-style="btn-select" multiple title="Días entrenamiento" required>
											<option th:each="fechaEntrenamiento : ${fechaEntrenamientoLista}" th:value="${#temporals.format(T(es.pocketrainer.util.FechaUtil).aClienteZoneId(fechaEntrenamiento), 'dd/MM/yyyy')}" th:text="${#temporals.format(T(es.pocketrainer.util.FechaUtil).aClienteZoneId(fechaEntrenamiento), 'EE dd MMM')}"></option>
										</select>
									</div>
									
									<div class="form-group col-12">
										<button id="actualizarRutinaFormularioSubmit" type="submit" class="btn btn-sm btn-azul" style="float: right;"><i class="fas fa-check"></i> Guardar cambios</button>
									</div>  
								</div>   
			  				</form>
			 	    </div>
	  			</div>
	  			
	  			<!-- Datos cliente -->
	  			<div class="row" style="margin: 0;">			  				
	  				<div class="col-12 pt-2 pb-2 mb-2 cursor-pointer shadow-sm " style="background:#0F4C81; color: #fff;" data-toggle="collapse" data-target="#rutinaCliente" aria-expanded="true" aria-controls="rutinaCliente">
						Cliente
					</div>
					
					<div id="rutinaCliente" class="col-12 pl-0 pr-0 collapse" aria-labelledby="headingTwo" data-parent="#accordion">
						<form id="clienteDatosFormulario" th:action="@{/clienteDatosFormulario}" th:object="${rutina.cliente}" method="post" novalidate>
							<div class="form-row">
								<div class="form-group col-12">
									<span style="font-weight: bold; font-size: 14px;"th:text="${rutina.cliente.nombreCompleto}"></span>
									<div style="font-size: 12px;">
										<span th:text="${rutina.cliente.edad}"></span> años, <span th:text="${rutina.cliente.peso}"></span> kg, <span th:text="${rutina.cliente.altura}"></span> cm
									</div>
								</div>
								
								
								
								<div class="form-group col-12">
								    <label for="objetivos">Objetivos</label>
								    <textarea id="objetivos" class="form-control form-control-sm" readonly th:field="*{objetivos}" placeholder="Perder peso, mejorar mi postura, mejorar imagen ..." rows="4" required></textarea>
								</div>
								<div class="form-group col-12">
								    <label for="lesiones">Lesiones actuales o pasadas</label>
								    <textarea id="lesiones" class="form-control form-control-sm" readonly th:field="*{lesiones}" rows="4"></textarea>
								</div>
								<div class="form-group col-12">
								    <label for="clavesEntrenamiento">Claves de entrenamiento</label>
								    <textarea id="clavesEntrenamiento" class="form-control form-control-sm" readonly th:field="*{clavesEntrenamiento}" rows="4"></textarea>
								</div>
								<div class="col-12">
									<label for="lugarEntrenamientoLista">Lugar entreno y material</label>
								</div>
								<div class="form-group col-6">
									<label for="lugarEntrenamientoLista" class="sr-only">Lugar  y material</label>
									<select id="lugarEntrenamientoLista" class="form-control form-control-sm selectpicker" th:field="*{lugarEntrenamientoLista}" data-style="btn-select" multiple title="Lugar" required>
									  <option th:each="lugarEntrenamiento : ${lugarEntrenamientoSeleccionLista}" th:value="${lugarEntrenamiento.codigo}" th:text="${lugarEntrenamiento.nombre}"></option>
									</select>
								</div>
								<div class="form-group col-6">
									<label for="materialLista" class="sr-only">Material que tiene</label>
									<select id="materialLista" class="form-control form-control-sm selectpicker" readonly th:field="*{materialLista}" data-style="btn-select" multiple title="Sin material" required>
									  <option th:each="material : ${materialSeleccionLista}" th:value="${material.id}" th:text="${material.nombre}"></option>
									</select>
								</div>
							</div>
						</form>
					</div>
	  			</div>
			</div>

            <!-- Rutina -->
  			<div id="elaboracionRutinaSeccionCentral" th:fragment="elaboracionRutinaSeccionCentralFragment" class="col-7 offset-2" style="margin-top: -30px; padding-bottom: 150px;">
					<!-- Fase inicial -->
	  				<div th:replace="fragmentos/rutinaFaseFragment.html :: rutinaFase(rutina=${rutina}, rutinaFase=${rutina.faseInicial})"/>
	  				
					<!-- Fase principal -->
	  				<div th:replace="fragmentos/rutinaFaseFragment.html :: rutinaFase(rutina=${rutina}, rutinaFase=${rutina.fasePrincipal})"/>
	  				
					<!-- Fase final -->
	  				<div th:replace="fragmentos/rutinaFaseFragment.html :: rutinaFase(rutina=${rutina}, rutinaFase=${rutina.faseFinal})"/>
  			</div>
  			
  			<!-- Seccion filtros -->
  			<div id="seccionFiltros" th:fragment="seccionFiltrosFragment" class="col-3 d-flex flex-column" style="height: calc(100% - 90px); position: fixed; right: 0px; top: 80px; bottom: 0px;">

  				<div class="row">
  					<div class="col-12">
  						<div style="background:#0F4C81; border-bottom: 1px solid white;" >
		  					<button onclick="$('#busquedaRapida').val('');" th:id="${'patron_' + patron.id}" th:text="${patron.codigo}" th:class="${'btn btn-sm btn-azul btn-filtro multiseleccionable ' + (ejercicioBusquedaFiltro.patronIdLista != null && ejercicioBusquedaFiltro.patronIdLista.contains(patron.id) ? 'seleccionado' : '')}" th:each="patron: ${patronLista}"
		  						asincrono="post" th:ruta="@{/patronSeleccionado}" zona-refresco="ejercicioListaFragment" th:datos="${patron.id}"></button>
		  				</div>
		  				<div style="background:#0F4C81; border-bottom: 1px solid white;" >
		  					<button onclick="$('#busquedaRapida').val('');" th:id="${'zona_' + zona.id}" th:text="${zona.codigo}" th:class="${'btn btn-sm btn-azul btn-filtro multiseleccionable ' + (ejercicioBusquedaFiltro.zonaIdLista != null && ejercicioBusquedaFiltro.zonaIdLista.contains(zona.id) ? 'seleccionado' : '')}" th:each="zona: ${zonaLista}"
		  						asincrono="post" th:ruta="@{/zonaSeleccionado}" zona-refresco="ejercicioListaFragment" th:datos="${zona.id}"></button>
		  				</div>
		  				<div style="background:#0F4C81; border-bottom: 1px solid white;" >	
		  					<button onclick="$('#busquedaRapida').val('');" th:id="${'parteCuerpo_' + parteCuerpo.id}" th:text="${parteCuerpo.codigo}" th:class="${'btn btn-sm btn-azul btn-filtro multiseleccionable ' + (ejercicioBusquedaFiltro.parteCuerpoIdLista != null && ejercicioBusquedaFiltro.parteCuerpoIdLista.contains(parteCuerpo.id) ? 'seleccionado' : '')}" th:each="parteCuerpo: ${parteCuerpoLista}"
			  					asincrono="post" th:ruta="@{/parteCuerpoSeleccionado}" zona-refresco="ejercicioListaFragment" th:datos="${parteCuerpo.id}"></button>
			  			</div>
			  			<div style="background:#0F4C81; border-bottom: 1px solid white;" >	
			  				<button onclick="$('#busquedaRapida').val('');" th:id="${'musculo_' + musculo.id}" th:text="${musculo.codigo}" th:class="${'btn btn-sm btn-azul btn-filtro multiseleccionable ' + (ejercicioBusquedaFiltro.musculoIdLista != null && ejercicioBusquedaFiltro.musculoIdLista.contains(musculo.id) ? 'seleccionado' : '')}" th:each="musculo: ${musculoLista}"
			  					asincrono="post" th:ruta="@{/musculoSeleccionado}" zona-refresco="ejercicioListaFragment" th:datos="${musculo.id}"></button>
		  				</div>
		  			</div>
  				</div>		
  			
  				<div class="form-row mt-1">
  				
  					
  					<div class="col-3">
  						<div class="form-row">
		  					<div class="col">
		  						<label for="busquedaRapida" class="sr-only"> Nombre de ejercicio </label>
							    <input id="busquedaRapida" type="text" class="form-control form-control-sm" placeholder="Nombre..."/> 
		  					</div>
		  				</div>
  					</div>
  					
  					<div class="col-4">
  						<div class="form-row">
	  						<div class="form-group col">
								<label for="material" class="sr-only"> Material</label>
								<div class="input-group">
									<select class="form-control form-control-sm selectpicker" id="material" name="material" data-style="btn-select" title="Material" multiple zona-refresco="ejercicioListaFragment" th:ruta="@{/materialSeleccionado}">
										<option th:each="material : ${materialSeleccionLista}" th:value="${material.id}" th:text="${material.nombre}" th:selected="${ejercicioBusquedaFiltro.materialIdLista != null? ejercicioBusquedaFiltro.materialIdLista.contains(material.id) : false}"></option>
									</select>
									<div class="input-group-append">
								    	<button onClick="materialTodoDeseleccionadoAccion(this)" th:data-accion="@{/materialTodoDeseleccionadoAccion}" class="btn btn-sm btn-outline-secondary" type="button"><i class="fas fa-times"></i></button>
								  	</div>
								</div>
							</div>					
						</div>
					</div>
					
					<div class="col-3">
						<label for="ejercicioUltimoUsoTipo" class="sr-only"> Uso</label>
						<select class="form-control form-control-sm selectpicker" id="ejercicioUltimoUsoTipo" name="ejercicioUltimoUsoTipo" data-style="btn-select" title="Uso" multiple zona-refresco="ejercicioListaFragment" th:ruta="@{/ejercicioUltimoUsoTipoSeleccionado}">
							<option th:each="ejercicioUltimoUsoTipo : ${ejercicioUltimoUsoTipoSeleccionLista}" 
							th:class="${ejercicioUltimoUsoTipo.cssClass}"
							th:value="${ejercicioUltimoUsoTipo.codigo}" 
							th:text="${ejercicioUltimoUsoTipo.codigo}" 
							th:selected="${ejercicioBusquedaFiltro.ejercicioUltimoUsoTipoLista != null? ejercicioBusquedaFiltro.ejercicioUltimoUsoTipoLista.contains(ejercicioUltimoUsoTipo.codigo) : false}"></option>
						</select>
					</div>
					
					<div class="col-auto ml-auto">
						<button onClick="cambioAutomaticoEjerciciosRutinaEntera(this)" class="btn btn-sm btn-azul" th:data-accion="@{/cambioAutomaticoEjerciciosRutinaEntera}" th:data-rutina-id="${rutina.id}">
							<i class="fas fa-magic"></i>
						</button>
					</div>
					
  				</div>

  				<div th:fragment="ejercicioListaFragment" id="ejercicioListaFragment" class="row" style="max-height: 100%; overflow-y: auto;">
					<div class="col-12 text-right">
						<span id="ejercicioListaCantidad" th:text="|${ejercicioLista.size()} ejercicios|" style="font-size: 0.8rem"></span>
					</div>
  					<div class="col-12">
  						<div class="row no-gutters" style="margin-right: -7px;">
		  				<div th:id="${'ejercicio_' + ejercicio.id}" class="con-claves col-4" style="padding-right: 7px;" th:each="ejercicio: ${ejercicioLista}" draggable="true" ondragstart="arrastrarEjercicioInicio(event)" ondragend="arrastrarEjercicioFin(event)" th:data-claves="${ejercicio.clavesBusqueda}">
		  					<div class="row ejercicio-seleccionable">
		  						<div th:replace="fragmentos/ejercicioFragment :: ejercicio(ejercicio=${ejercicio},tam='pequenho')"/>
		  					</div>
		  				</div>
		  				</div>
	  				</div>
  				</div>
  			</div>
  			
  		</div>
  		
  		<!-- Modal crear plantilla desde rutina -->
		<div class="modal fade" id="crearPlantillaDesdeRutinaModal" th:fragment="crearPlantillaDesdeRutinaModalFragment" tabindex="-1" role="dialog" aria-labelledby="crearPlantillaDesdeRutinaModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="crearPlantillaDesdeRutinaModalLabel">
							Crear plantilla
						</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body" th:if="${plantilla}">
						<form id="crearPlantillaDesdeRutinaFormulario" th:action="@{/crearPlantillaDesdeRutinaFormulario}" th:object="${plantilla}" onsubmit="crearPlantillaDesdeRutinaFormulario(this, event)" method="post" novalidate>
							<div class="form-row">
			 					<input type="hidden" id="crearPlantillaDesdeRutinaFormulario-id" th:field="*{id}" />
			 					<div class="form-group col-12">
					            	<label for="crearPlantillaDesdeRutinaFormulario-nombre"> Nombre de la plantilla </label>
					            	<input id="crearPlantillaDesdeRutinaFormulario-nombre" type="text" class="form-control form-control-sm" th:field="*{nombre}" placeholder="Nombre de la rutina" maxlength="30" required/> 
					            </div>
					            <div class="form-group col-12">
								    <label for="crearPlantillaDesdeRutinaFormulario-comentariosEntrenador">Comentarios</label>
								    <textarea id="crearPlantillaDesdeRutinaFormulario-comentariosEntrenador" class="form-control form-control-sm" th:field="*{comentariosEntrenador}" placeholder="Comentarios" rows="3" required></textarea>
								</div>
								
								<div class="form-group col-12">
									<button id="crearPlantillaDesdeRutinaFormularioSubmit" type="submit" class="btn btn-sm btn-azul" style="display: none;"><i class="fas fa-check"></i> Guardar cambios</button>
								</div>  
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" data-dismiss="modal" class="btn btn-sm btn-outline-danger">Cancelar</button>
						<a id="crearPlantillaDesdeRutinaFormularioSubmitFake" href="#" onclick="$('#crearPlantillaDesdeRutinaFormularioSubmit').click()" type="button" class="btn btn-sm btn-success">Guardar</a>
					</div>
				</div>
			</div>
		</div>
		
		<!-- Modal cargar plantilla en rutina -->
		<div class="modal fade" id="cargarPlantillaModal" th:fragment="cargarPlantillaModalFragment" tabindex="-1" role="dialog" aria-labelledby="cargarPlantillaModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-xl" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="cargarPlantillaModalLabel">
							Cargar plantilla
						</h5>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close">
							<span aria-hidden="true">&times;</span>
						</button>
					</div>
					<div class="modal-body" th:if="${plantillaLista}">
					
						<!-- Filtros -->
						<div>
							<form id="buscarPlantillaDesdeElaboracionRutinaFormulario" th:action="@{/buscarPlantillaDesdeElaboracionRutinaFormulario}" th:object="${buscarPlantillaFormulario}" onsubmit="buscarPlantillaDesdeElaboracionRutinaFormulario(this, event)" method="post" novalidate>
					  			<div class="form-row">
									<div class="form-group col-auto">
										<label for="nombre"> Nombre </label>
										<div class="input-group">					            	
							            	<input id="nombre" type="text" class="form-control form-control-sm" th:field="*{nombre}" maxlength="100" placeholder="Nombre"/>
							            	<div class="input-group-append">
										    	<button class="btn-borrar-input btn btn-sm btn-outline-secondary" type="button"><i class="fas fa-times"></i></button>
										  	</div>
										</div>
						            </div>
									<div class="form-group col-auto">
						            	<label for="comentariosEntrenador"> Comentarios </label>
						            	<div class="input-group">
						            		<input id="comentariosEntrenador" type="text" class="form-control form-control-sm" th:field="*{comentariosEntrenador}" maxlength="100" placeholder="Comentarios"/>
						            		<div class="input-group-append">
										    	<button class="btn-borrar-input btn btn-sm btn-outline-secondary" type="button"><i class="fas fa-times"></i></button>
										  	</div>
										</div>
						            </div>
						            <div class="form-group col-auto">
										<label for="entrenadorId">Entrenador</label>
										<select class="form-control form-control-sm selectpicker buscarPlantillaDesdeElaboracionRutinaFormulario-select" th:field="*{entrenadorId}" data-style="btn-select" title="Entrenador">
											<option selected value="">Cualquiera</option>
											<option th:each="entrenador : ${entrenadorSeleccionLista}" th:value="${entrenador.id}" th:text="${entrenador.nombreCompleto}"></option>
										</select>
									</div>
									<div class="form-group col-auto mt-auto">
										<button id="buscarPlantillaFormularioSubmit" type="submit" class="btn btn-sm btn-outline-azul"><i class="fas fa-search"></i> Buscar</button>
									</div>
					  			</div>
					  		</form>
					  	</div>
					
					
						<!-- Listado -->
						<div id="plantillaLista" th:fragment="plantillaListaFragment" class="table-responsive tabla-cabecera-fija tabla-pantalla-completa-300">
							<table class="table table-sm table-hover">
								<thead class="thead-pocketrainer">
									<tr>
<!-- 										<th scope="col">ID</th> -->
										<th scope="col">Nombre</th>
										<th scope="col">Comentarios</th>
										<th scope="col">Entrenador</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="plantilla: ${plantillaLista}" class="plantillaListaFila cursor-pointer" th:data-plantilla-id="${plantilla.id}">
<!-- 										<th th:text="${plantilla.id}"></th> -->
										<th th:text="${plantilla.nombre}" style="white-space: nowrap;"></th>
										<td th:text="${plantilla.comentariosEntrenador}"></td>
										<td th:if="${plantilla.entrenador}" th:text="${plantilla.entrenador.nombreCompleto}"></td>
										<td th:unless="${plantilla.entrenador}"></td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" data-dismiss="modal" class="btn btn-sm btn-outline-danger">Cancelar</button>
						<a th:if="${plantillaLista}" id="cargarPlantillaAccion" th:hrefbase="@{/cargarPlantillaAccion/{rutinaId}(rutinaId=${rutinaId})}" href="#"  type="button" class="btn btn-sm btn-success">Cargar</a>
						
<!-- 						<a th:if="${plantillaLista}" id="cargarPlantillaAccion" href="#" onClick="cargarPlantillaAccion(this)" th:data-accion="@{/cargarPlantillaAccion}" th:data-rutina-id="${rutinaId}" type="button" class="btn btn-sm btn-success">Cargar</a> -->
					</div>
				</div>
			</div>
		</div>
  		
		<script src="/js/rutinaElaboracionPagina.js" th:src="@{/js/rutinaElaboracionPagina.js}"></script>
    </div>

  </body>
</html>